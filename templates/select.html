<!-- select.html -->

<!DOCTYPE html>
<html lang="en">
	<head>
		<!-- 引入 Bootstrap 样式 -->
		<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">

		<style>
			.operation-done {
				background-color: #f0f0f0;
				/* 设置背景色为灰色 */
				color: #777777;
				/* 设置文字颜色为深灰色 */
			}

			/* 设置水平布局 */
			.horizontal-layout {
				display: flex;
				/* 使用 flex 布局 */
			}

			h1 {
				text-align: center;
				font-size: 28px;
				color: #ffffff;
				font-weight: bold;
				 
				/* 设置标题颜色 */
				/* 其他样式设置 */
			}

			h5 {
				color: forestgreen;
			}

			/* 设置表格字体大小 */
			table td,
			th {
				border: 1px solid black;
				font-size: 12px;
				/* 设置字体大小为16像素 */
				border: 1px solid #ccc;
				/* 灰色边框 */
			}

			thead {
				background-color: #555fff;
				color: #ffffff;
			}

			/* 按钮样式 */
			button {


				cursor: pointer;
				/* 设置鼠标悬停样式 */
			}
		</style>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">

		<title>potato curation</title>
	</head>
	<body>
		<div>
			<div style="display: flex; align-items: center; justify-content: center; text-align: center; background-color:#7cba59; height:100px;">

				<!--<img src="images/userpencil.jpg">-->

				<h1>Potato Ontology Curation Management Platform</h1>
			</div>


			<div class="container mt-5">

				<h5>Add</h5>
				<div class="horizontal-layout">
					<table style="border: 1px solid white;" width="100%" weight="30%" background-color: #10b08f;>
						<tr>
							<td>
								<form class="insertForm" action="submit_insert" method="post" style="flex: 1;">
									<label for="sub">Subject&ensp;&ensp;&ensp;&ensp;&ensp;</label>
									<input type="text" name="sub" id="sub">

									<label for="sub_type">SubjectType&ensp;</label>
									<input type="text" name="sub_type" id="sub_type">

									<label for="sc">SubStandard&ensp;</label>
									<input type="text" name="sc" id="sc">
									<br>
									<label for="relation">Relation&ensp;&ensp;&ensp;&ensp;</label>
									<input type="text" name="relation" id="relation">
									<br>
									<label for="obj">Object&ensp;&ensp;&ensp;&ensp;&ensp;</label>
									<input type="text" name="obj" id="obj">

									<label for="obj_type">ObjectType&ensp;&ensp;</label>
									<input type="text" name="obj_type" id="obj_type">

									<label for="oc">ObStandard&ensp;&ensp;</label>
									<input type="text" name="oc" id="oc">
									<br>
									<label for="pmid">PMID&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;</label>
									<input type="text" name="pmid" id="pmid">

									<label for="sentence">Sentence&ensp;&ensp;&ensp;&ensp;</label>
									<input type="text" name="sentence" id="sentence" style="width: 360px;">

									<button type="submit" class="btn btn-primary add-button">插入</button>
									<br><br>
								</form>
							</td>
						</tr>
					</table>


				</div>

				{% for result in results %}

				<table border="1" width="100%" weight="30%"
					class="{% if result.operation_done %}operation-done{% endif %}">
					<thead>
						<tr>
							<th>ID</th>
							<th>Subject</th>
							<th>S_type</th>
							<th>S_standard</th>
							<th>Relation</th>
							<th>Object</th>
							<th>O_type</th>
							<th>O_standard</th>
							<th>PMID</th>
							<th>sentence</th>
							<th>Edit</th>
							<th>Delete</th>

						</tr>
					</thead>
					<tbody>

						<tr>
							<td>{{ result[0] }}</td>
							<td>{{ result[1] }}</td>
							<td>{{ result[2] }}</td>
							<td>{{ result[3] }}</td>
							<td>{{ result[4] }}</td>
							<td>{{ result[5] }}</td>
							<td>{{ result[6] }}</td>
							<td>{{ result[7] }}</td>
							<td>{{ result[8] }}</td>
							<td>{{ result[9] }}</td>
							<td>


								<form class="editForm" action="submit_update" method="post">
									<input type="hidden" name="id" value="{{ result[0] }}">

									<input type="text" name="sub" placeholder="sub" value="{{ result[1] }}">

									<br>
									<input type="text" name="sub_type" placeholder="sub_type" value="{{ result[2] }}">

									<br>
									<input type="text" name="sc" placeholder="sc" value="{{ result[3] }}">

									<br>
									<input type="text" name="relation" placeholder="relation" value="{{ result[4] }}">

									<br>
									<input type="text" name="obj" placeholder="obj" value="{{ result[5] }}">

									<br>
									<input type="text" name="obj_type" placeholder="obj_type" value="{{ result[6] }}">

									<br>
									<input type="text" name="oc" placeholder="oc" value="{{ result[7] }}">

									<br>
									<input type="text" name="sentence" placeholder="sentence" value="{{ result[9] }}">

									<button type="submit" class="btn btn-warning edit-button">修改</button>
								</form>


							</td>
							<td>
								<!-- 添加确认对话框 -->
								<button type="button" class="btn btn-danger"
									onclick="confirmDelete({{ result[0] }})">Delete</button>

							</td>
						</tr>
						{% endfor %}
					</tbody>
				</table>
				<!-- 引入 Bootstrap JavaScript -->
				<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js">
				</script>
				<!-- 引入 jQuery -->
				<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
				<script>
					function confirmDelete(id) {
						// 弹出确认对话框
						if (confirm("Are you sure you want to delete this item?")) {
							// 如果用户点击了确认按钮，执行删除逻辑
							deleteData(id);
						}
					}

					function deleteData(id) {
						$.ajax({
							url: 'delete', // 后端删除数据的接口地址
							type: 'POST',
							data: {
								id: id
							}, // 发送的数据，这里是要删除的数据的 ID
							success: function(response) {
								alert("Item deleted successfully");
								location.reload(); // 刷新页面

								var deletePage = Math.ceil(response.total_records / PAGE_SIZE); // 计算插入数据所在的页码
								var url = new URL(window.location.href);
								url.searchParams.set('page', deletePage); // 设置页码参数为插入数据所在的页码
								window.location.href = url.toString(); // 修改页面 URL 并刷新页面
								// 在成功删除后，可以执行一些其他操作，比如重新加载数据表格等
							},
							error: function(xhr, status, error) {
								alert("Error deleting item");
								console.error(xhr.responseText);
							}
						});
					}



					// 提交编辑表单
					$('.editForm').submit(function(event) {
						event.preventDefault(); // 阻止表单默认提交行为
						var form = $(this);
						$.ajax({
							type: form.attr('method'),
							url: form.attr('action'),
							data: form.serialize(),
							success: function(response) {
								alert("Item updated successfully");
								location.reload(); // 刷新页面
								var updatePage = Math.ceil(response.total_records / PAGE_SIZE); // 计算插入数据所在的页码
								var url = new URL(window.location.href);
								url.searchParams.set('page', updatePage); // 设置页码参数为插入数据所在的页码
								window.location.href = url.toString(); // 修改页面 URL 并刷新页面
							},
							error: function(xhr, status, error) {
								alert("Error updating item");
								console.error(xhr.responseText);
							}
						});
					});

					// 提交插入表单
					$('.insertForm').submit(function(event) {
						event.preventDefault(); // 阻止表单默认提交行为
						var form = $(this);
						$.ajax({
							type: form.attr('method'),
							url: form.attr('action'),
							data: form.serialize(),
							success: function(response) {
								alert("Item insert successfully");
								location.reload(); // 刷新页面
								var insertedPage = Math.ceil(response.total_records / PAGE_SIZE); // 计算插入数据所在的页码
								var url = new URL(window.location.href);
								url.searchParams.set('page', insertedPage); // 设置页码参数为插入数据所在的页码
								window.location.href = url.toString(); // 修改页面 URL 并刷新页面
							},
							error: function(xhr, status, error) {
								alert("Error inserting item");
								console.error(xhr.responseText);
							}
						});
					});
				</script>

				<br>
				<br>


				<!-- 分页控件 -->
				<nav aria-label="Page navigation">
					<ul class="pagination">
						{% if page > 1 %}
						<li class="page-item">
							<a class="page-link" href="?page={{ page - 1 }}">Previous</a>
						</li>
						{% endif %}
						{% if page > 3 %}
						<li class="page-item">
							<a class="page-link" href="?page=1">1</a>
						</li>
						<li class="page-item disabled">
							<span class="page-link">...</span>
						</li>
						{% endif %}
						{% set start_page = (page - 2) if (page - 2) > 0 else 1 %}
						{% set end_page = (page + 2) if (page + 2) <= total_pages else total_pages %}
						{% for pg in range(start_page, end_page + 1) %}
						<li class="page-item {% if pg == page %}active{% endif %}">
							<a class="page-link" href="?page={{ pg }}">{{ pg }}</a>
						</li>
						{% endfor %}
						{% if page < total_pages - 2 %}
						<li class="page-item disabled">
							<span class="page-link">...</span>
						</li>
						<li class="page-item">
							<a class="page-link" href="?page={{ total_pages }}">{{ total_pages }}</a>
						</li>
						{% endif %}
						{% if page < total_pages %}
						<li class="page-item">
							<a class="page-link" href="?page={{ page + 1 }}">Next</a>
						</li>
						{% endif %}
						<!-- 选择页数的下拉框 -->
						<li class="page-item">
							<select class="form-control" onchange="location = this.value;">
								{% for pg in range(1, total_pages + 1) %}
								<option value="?page={{ pg }}" {% if pg==page %}selected{% endif %}>---{{ pg }}---
								</option>
								{% endfor %}
							</select>
						</li>
					</ul>
				</nav>


			</div>
		</div>
	</body>
</html>